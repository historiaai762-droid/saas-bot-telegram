<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Telegram Premium - Agendamento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* NOTIFICA√á√ïES */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
            pointer-events: none;
        }

        .notification {
            background: linear-gradient(135deg, #1a1f2e 0%, #0f1419 100%);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            min-width: 320px;
            pointer-events: all;
            cursor: pointer;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.slide-out {
            animation: slideOut 0.3s ease forwards;
        }

        @keyframes slideOut {
            to { transform: translateX(450px); opacity: 0; }
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #b9ff00, #00ff88);
        }

        .notification.success::before { background: linear-gradient(180deg, #00ff88, #00cc6a); }
        .notification.error::before { background: linear-gradient(180deg, #ff0055, #cc0044); }
        .notification.warning::before { background: linear-gradient(180deg, #ffd700, #ff8800); }
        .notification.info::before { background: linear-gradient(180deg, #00d4ff, #0099cc); }

        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 204, 106, 0.2));
            color: #00ff88;
        }

        .notification.error .notification-icon {
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.2), rgba(204, 0, 68, 0.2));
            color: #ff0055;
        }

        .notification.warning .notification-icon {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 136, 0, 0.2));
            color: #ffd700;
        }

        .notification.info .notification-icon {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 153, 204, 0.2));
            color: #00d4ff;
        }

        .notification-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .notification-title {
            font-weight: 700;
            font-size: 14px;
            color: #ffffff;
        }

        .notification-message {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .notification-close {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s;
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, #1a1f2e 0%, #0a0e1a 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 1px solid rgba(255, 215, 0, 0.3);
            text-align: center;
        }

        .logo-container img {
            width: 160px;
            height: auto;
            filter: drop-shadow(0 15px 40px rgba(255, 215, 0, 0.5));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        h1 {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.2em;
            font-weight: 900;
            animation: goldShine 3s linear infinite;
            margin-bottom: 8px;
        }

        @keyframes goldShine {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .subtitle {
            color: #888;
            font-size: 0.85em;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* LAYOUT */
        .main-layout {
            display: grid;
            grid-template-columns: 380px 1fr 380px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .left-column, .center-column, .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section {
            background: linear-gradient(135deg, #1a1f2e 0%, #0a0e1a 100%);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(185, 255, 0, 0.15);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(185, 255, 0, 0.1);
        }

        .section h2 {
            color: #fff;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 22px;
            background: linear-gradient(135deg, #ffd700 0%, #ffc107 100%);
            border-radius: 2px;
        }

        .section-badge {
            background: linear-gradient(135deg, #b9ff00 0%, #00ff88 100%);
            color: #0a0e1a;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        /* FORMS */
        label {
            display: block;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-weight: 600;
            font-size: 13px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid rgba(185, 255, 0, 0.2);
            border-radius: 10px;
            font-size: 14px;
            background: rgba(26, 31, 46, 0.8);
            color: #fff;
            transition: all 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #b9ff00;
            background: rgba(26, 31, 46, 0.95);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .btn {
            background: linear-gradient(135deg, #b9ff00 0%, #00ff88 100%);
            color: #0a0e1a;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 8px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(185, 255, 0, 0.4);
        }

        .btn:disabled {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.3);
            cursor: not-allowed;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #0a0e1a;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            width: auto;
            display: inline-block;
            margin: 0 5px 5px 0;
        }

        /* STATUS */
        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .status.offline {
            background: linear-gradient(135deg, #ff0055 0%, #cc0044 100%);
            color: white;
        }

        .status.online {
            background: linear-gradient(135deg, #b9ff00 0%, #00ff88 100%);
            color: #0a0e1a;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* STATS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .stat-card {
            background: rgba(26, 31, 46, 0.9);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(185, 255, 0, 0.2);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #b9ff00 0%, #00ff88 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 11px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
        }

        /* POSTS */
        .post-item {
            background: rgba(26, 31, 46, 0.6);
            border: 1px solid rgba(185, 255, 0, 0.2);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .post-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .post-type.texto { background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%); color: white; }
        .post-type.imagem { background: linear-gradient(135deg, #b9ff00 0%, #8acc00 100%); color: #0a0e1a; }
        .post-type.video { background: linear-gradient(135deg, #ff00aa 0%, #cc0088 100%); color: white; }

        .post-content {
            color: #e0e0e0;
            margin-bottom: 8px;
            font-size: 12px;
            line-height: 1.5;
        }

        .post-preview-img {
            width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin: 8px 0;
            border: 2px solid rgba(185, 255, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .post-preview-img:hover {
            border-color: #b9ff00;
            transform: scale(1.02);
        }

        .post-preview-video {
            width: 100%;
            max-height: 150px;
            border-radius: 8px;
            margin: 8px 0;
            border: 2px solid rgba(185, 255, 0, 0.2);
        }

        .preview-badge {
            display: inline-block;
            background: rgba(185, 255, 0, 0.2);
            color: #b9ff00;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-top: 6px;
        }

        /* MODAL DE PREVIEW */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1f2e 0%, #0a0e1a 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid rgba(185, 255, 0, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 0, 85, 0.2);
            color: #ff0055;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: rgba(255, 0, 85, 0.4);
            transform: rotate(90deg);
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(185, 255, 0, 0.2);
        }

        .modal-header h3 {
            color: #fff;
            font-size: 1.5em;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-body {
            color: #e0e0e0;
        }

        .modal-preview-image {
            width: 100%;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px solid rgba(185, 255, 0, 0.3);
        }

        .modal-preview-video {
            width: 100%;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px solid rgba(185, 255, 0, 0.3);
        }

        .modal-text {
            background: rgba(26, 31, 46, 0.6);
            padding: 15px;
            border-radius: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
            font-size: 14px;
            margin: 15px 0;
            border-left: 4px solid #b9ff00;
        }

        .modal-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .modal-info-item {
            background: rgba(26, 31, 46, 0.6);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
        }

        .modal-info-label {
            color: #b9ff00;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .modal-info-value {
            color: #fff;
        }

        .fila-scroll {
            max-height: 450px;
            overflow-y: auto;
            padding-right: 8px;
        }

        /* LOG */
        .log {
            background: #0a0a0a;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            border: 1px solid rgba(185, 255, 0, 0.1);
        }

        .log-entry { margin-bottom: 5px; }
        .log-error { color: #ff6b6b; }
        .log-success { color: #51cf66; }
        .log-warning { color: #ffd43b; }

        /* AGENDAMENTO - NOVO */
        .schedule-box {
            background: rgba(255, 215, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .schedule-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .schedule-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin: 0;
        }

        .schedule-fields {
            display: none;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
        }

        .schedule-fields.active {
            display: block;
        }

        .time-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .countdown-badge {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .scheduled-post {
            border: 2px solid rgba(255, 215, 0, 0.5);
            background: rgba(255, 215, 0, 0.05);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(26, 31, 46, 0.5); }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #b9ff00 0%, #00ff88 100%);
            border-radius: 10px;
        }

        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 1fr 1fr;
            }
            .right-column {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="notification-container" id="notificationContainer"></div>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="logo-container">
                <img src="https://i.ibb.co/bR1dHts5/telegram-bot-premium.png" alt="Bot Telegram Premium">
            </div>
            <h1>ü§ñ Bot Telegram Premium</h1>
            <p class="subtitle">Sistema Profissional com Agendamento</p>
        </div>

        <div class="main-layout">
            
            <!-- COLUNA ESQUERDA -->
            <div class="left-column">
                
                <!-- CONFIGURA√á√ÉO -->
                <div class="section">
                    <div class="section-header">
                        <h2>‚öôÔ∏è Configura√ß√£o</h2>
                    </div>
                    
                    <div style="background: rgba(255, 215, 0, 0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px; border: 2px solid rgba(255, 215, 0, 0.3);">
                        <label style="color: #ffd700; font-weight: 700;">üë§ Perfil Ativo</label>
                        <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                            <select id="seletorPerfil" style="flex: 1;" onchange="carregarPerfil()">
                                <option value="perfil1">Perfil 1</option>
                                <option value="perfil2">Perfil 2</option>
                                <option value="perfil3">Perfil 3</option>
                                <option value="perfil4">Perfil 4</option>
                                <option value="perfil5">Perfil 5</option>
                                <option value="perfil6">Perfil 6</option>
                                <option value="perfil7">Perfil 7</option>
                                <option value="perfil8">Perfil 8</option>
                                <option value="perfil9">Perfil 9</option>
                                <option value="perfil10">Perfil 10</option>
                            </select>
                            <button class="btn btn-small btn-success" onclick="salvarPerfil()" title="Salvar Perfil">üíæ</button>
                            <button class="btn btn-small" onclick="renomearPerfil()" title="Renomear Perfil">‚úèÔ∏è</button>
                        </div>
                        
                        <div id="perfilInfo" style="background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 6px; font-size: 11px; color: rgba(255,255,255,0.7);">
                            <div style="margin-bottom: 4px;">
                                <strong style="color: #ffd700;">Nome:</strong> 
                                <span id="perfilNome">Sem nome</span>
                            </div>
                            <div style="margin-bottom: 4px;">
                                <strong style="color: #00ff88;">Token:</strong> 
                                <span id="perfilToken">N√£o configurado</span>
                            </div>
                            <div>
                                <strong style="color: #00d4ff;">Chat ID:</strong> 
                                <span id="perfilChatId">N√£o configurado</span>
                            </div>
                        </div>
                    </div>
                    
                    <label>Token do Bot:</label>
                    <div style="position: relative;">
                        <input type="password" id="botToken" placeholder="123456:ABC-DEF...">
                        <button onclick="toggleTokenVisibility()" style="position: absolute; right: 10px; top: 12px; background: none; border: none; color: #b9ff00; cursor: pointer; font-size: 18px;" title="Mostrar/Ocultar">
                            üëÅÔ∏è
                        </button>
                    </div>
                    
                    <button class="btn btn-success" onclick="testarConexao()">üîó Testar Conex√£o</button>
                    
                    <label>Chat ID:</label>
                    <input type="text" id="chatId" placeholder="Ser√° preenchido automaticamente">
                    
                    <button class="btn" onclick="descobrirChatId()">üîç Descobrir Chat ID</button>

                    <label>Intervalo (minutos):</label>
                    <input type="number" id="intervalo" value="60" min="1">

                    <div style="background: rgba(0, 212, 255, 0.1); padding: 12px; border-radius: 10px; margin-top: 15px; border-left: 3px solid #00d4ff;">
                        <div style="font-size: 11px; color: rgba(255,255,255,0.7); line-height: 1.6;">
                            <strong style="color: #00d4ff;">üìò GUIA R√ÅPIDO:</strong><br>
                            1Ô∏è‚É£ Crie bot com @BotFather<br>
                            2Ô∏è‚É£ Cole token e teste conex√£o<br>
                            3Ô∏è‚É£ Adicione bot ao grupo/canal<br>
                            4Ô∏è‚É£ Torne ADMINISTRADOR<br>
                            5Ô∏è‚É£ Descubra Chat ID e salve perfil!
                        </div>
                    </div>
                </div>

                <!-- CONTROLES -->
                <div class="section">
                    <div class="section-header">
                        <h2>üéÆ Controles</h2>
                    </div>
                    
                    <div class="status offline" id="status">
                        <span class="status-dot"></span>
                        Offline
                    </div>
                    
                    <button class="btn" id="startBtn" onclick="iniciarBot()">‚ñ∂Ô∏è Iniciar Bot</button>
                    <button class="btn btn-danger" id="stopBtn" disabled onclick="pararBot()">‚èπÔ∏è Parar Bot</button>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="postsEnviados">0</div>
                            <div class="stat-label">Enviados</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="agendados">0</div>
                            <div class="stat-label">Agendados</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="cicloAtual">0/0</div>
                            <div class="stat-label">Posi√ß√£o</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="tempoRodando">00:00:00</div>
                            <div class="stat-label">Tempo</div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- COLUNA CENTRAL -->
            <div class="center-column">
                
                <!-- CRIAR POST -->
                <div class="section">
                    <div class="section-header">
                        <h2>‚ûï Criar Post</h2>
                        <span class="section-badge">Novo</span>
                    </div>
                    
                    <label>Tipo de Post:</label>
                    <select id="tipoPost" onchange="atualizarCampos()">
                        <option value="texto">üìù Texto</option>
                        <option value="imagem">üñºÔ∏è Imagem</option>
                        <option value="video">üé• V√≠deo</option>
                    </select>

                    <div id="campoTexto">
                        <label>Mensagem:</label>
                        <textarea id="mensagemTexto" placeholder="Digite sua mensagem..."></textarea>
                    </div>

                    <div id="campoArquivo" style="display:none;">
                        <label id="labelArquivo">Arquivo:</label>
                        <input type="file" id="arquivo" accept="image/*,video/*" onchange="previewArquivo()">
                        <div id="preview"></div>
                        <label>Legenda:</label>
                        <textarea id="legenda" placeholder="Digite a legenda..."></textarea>
                    </div>

                    <!-- AGENDAMENTO - NOVO -->
                    <div class="schedule-box">
                        <label class="schedule-toggle" style="color: #ffd700; font-weight: 700;">
                            <input type="checkbox" id="agendarPost" onchange="toggleAgendamento()">
                            <span>üïê Agendar Postagem</span>
                        </label>
                        
                        <div id="scheduleFields" class="schedule-fields">
                            <label>Tipo de Agendamento:</label>
                            <select id="tipoAgendamento" onchange="atualizarCamposAgendamento()">
                                <option value="unico">üìÖ Data e Hora √önica</option>
                                <option value="diario">üîÑ Diariamente</option>
                                <option value="semanal">üìÜ Semanalmente</option>
                                <option value="mensal">üìä Mensalmente</option>
                            </select>

                            <div id="campoDataUnica">
                                <label>Data e Hora:</label>
                                <div class="time-input-group">
                                    <input type="date" id="dataAgendamento">
                                    <input type="time" id="horaAgendamento">
                                </div>
                            </div>

                            <div id="campoDiario" style="display:none;">
                                <label>Hor√°rio Di√°rio:</label>
                                <input type="time" id="horaDiaria">
                            </div>

                            <div id="campoSemanal" style="display:none;">
                                <label>Dia da Semana:</label>
                                <select id="diaSemana">
                                    <option value="0">Domingo</option>
                                    <option value="1">Segunda-feira</option>
                                    <option value="2">Ter√ßa-feira</option>
                                    <option value="3">Quarta-feira</option>
                                    <option value="4">Quinta-feira</option>
                                    <option value="5">Sexta-feira</option>
                                    <option value="6">S√°bado</option>
                                </select>
                                <label>Hor√°rio:</label>
                                <input type="time" id="horaSemanal">
                            </div>

                            <div id="campoMensal" style="display:none;">
                                <label>Dia do M√™s:</label>
                                <input type="number" id="diaMes" min="1" max="31" placeholder="1-31">
                                <label>Hor√°rio:</label>
                                <input type="time" id="horaMensal">
                            </div>
                        </div>
                    </div>

                    <button class="btn" onclick="adicionarPost()">‚ûï Adicionar √† Fila</button>
                </div>

                <!-- LOG -->
                <div class="section">
                    <div class="section-header">
                        <h2>üìä Log do Sistema</h2>
                        <button class="btn btn-small" onclick="limparLog()">üóëÔ∏è</button>
                    </div>
                    <div class="log" id="log"></div>
                </div>

            </div>

            <!-- COLUNA DIREITA -->
            <div class="right-column">
                
                <!-- FILA NORMAL -->
                <div class="section">
                    <div class="section-header">
                        <h2>üìã Fila de Posts</h2>
                        <span class="section-badge" id="totalPosts">0</span>
                    </div>
                    <div class="fila-scroll" id="filaPosts">
                        <p style="color: rgba(255,255,255,0.5); text-align: center; padding: 30px 0;">
                            Nenhum post na fila
                        </p>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="limparFila()">üóëÔ∏è Limpar Fila</button>
                </div>

                <!-- POSTS AGENDADOS - NOVO -->
                <div class="section">
                    <div class="section-header">
                        <h2>üïê Posts Agendados</h2>
                        <span class="section-badge" id="totalAgendados">0</span>
                    </div>
                    <div class="fila-scroll" id="filaAgendados">
                        <p style="color: rgba(255,255,255,0.5); text-align: center; padding: 30px 0;">
                            Nenhum post agendado
                        </p>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="limparAgendados()">üóëÔ∏è Limpar Agendados</button>
                </div>

                <!-- TEMPLATES -->
                <div class="section">
                    <div class="section-header">
                        <h2>üé® Templates</h2>
                        <span class="section-badge" id="totalTemplates">0</span>
                    </div>
                    <div class="fila-scroll" id="listaTemplates">
                        <p style="color: rgba(255,255,255,0.5); text-align: center; padding: 30px 0;">
                            Nenhum template salvo
                        </p>
                    </div>
                    <button class="btn btn-small" onclick="salvarTemplate()">üíæ Salvar Template Atual</button>
                </div>

                <!-- BACKUP -->
                <div class="section">
                    <div class="section-header">
                        <h2>üì§ Backup</h2>
                    </div>
                    <button class="btn btn-success" onclick="exportarConfiguracao()">üì• Exportar Tudo</button>
                    <button class="btn" onclick="document.getElementById('importFile').click()">üì§ Importar Backup</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importarConfiguracao(event)">
                    
                    <div style="background: rgba(0, 212, 255, 0.1); padding: 12px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #00d4ff;">
                        <div style="font-size: 11px; color: rgba(255,255,255,0.7);">
                            <strong style="color: #00d4ff;">üí° Backup inclui:</strong><br>
                            ‚Ä¢ Configura√ß√µes do bot<br>
                            ‚Ä¢ Posts agendados<br>
                            ‚Ä¢ Templates salvos<br>
                            ‚Ä¢ Todos os perfis
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <script>
        // NOTIFICA√á√ïES
        const notificationIcons = {
            success: '‚úî',
            error: '‚úï',
            warning: '!',
            info: 'i'
        };

        function showNotification(type = 'info', title = '', message = '', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            const notificationId = 'notif-' + Date.now();
            
            notification.className = `notification ${type}`;
            notification.id = notificationId;
            notification.innerHTML = `
                <div class="notification-icon">${notificationIcons[type]}</div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    ${message ? `<div class="notification-message">${message}</div>` : ''}
                </div>
                <button class="notification-close" onclick="closeNotification('${notificationId}')">√ó</button>
            `;
            
            container.appendChild(notification);
            
            if (duration > 0) {
                setTimeout(() => closeNotification(notificationId), duration);
            }
            
            return notificationId;
        }

        function closeNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            if (notification) {
                notification.classList.add('slide-out');
                setTimeout(() => notification.remove(), 300);
            }
        }

        // VARI√ÅVEIS GLOBAIS
        let botAtivo = false;
        let intervaloId = null;
        let checkAgendadosId = null;
        let postsEnviados = 0;
        let inicioBot = null;
        let tempoRodandoId = null;
        let filaDePosts = [];
        let filaOriginal = [];
        let postsAgendados = [];
        let templates = [];
        let perfilAtual = 'perfil1';

        // FUN√á√ïES DE CONFIGURA√á√ÉO
        window.onload = function() {
            carregarDados();
            carregarPerfil();
            atualizarSeletorPerfis();
            log('Sistema iniciado com agendamento', 'success');
            showNotification('info', 'Sistema Pronto', 'Bot com agendamento ativo!');
            iniciarMonitoramentoAgendados();
        };

        function carregarDados() {
            const dados = JSON.parse(localStorage.getItem('telegram_bot_data') || '{}');
            postsAgendados = dados.agendados || [];
            templates = dados.templates || [];
            atualizarFilaAgendados();
            atualizarListaTemplates();
        }

        function salvarDados() {
            const dados = JSON.parse(localStorage.getItem('telegram_bot_data') || '{}');
            dados.agendados = postsAgendados;
            dados.templates = templates;
            localStorage.setItem('telegram_bot_data', JSON.stringify(dados));
        }

        // ===================================
        // SISTEMA DE PERFIS
        // ===================================
        function atualizarSeletorPerfis() {
            const seletor = document.getElementById('seletorPerfil');
            seletor.innerHTML = '';
            
            for (let i = 1; i <= 10; i++) {
                const chavePerfil = `perfil${i}`;
                const config = JSON.parse(localStorage.getItem(`telegram_${chavePerfil}`) || '{}');
                const nomePerfil = config.nome || `Perfil ${i}`;
                
                const option = document.createElement('option');
                option.value = chavePerfil;
                option.textContent = nomePerfil;
                seletor.appendChild(option);
            }
            
            seletor.value = perfilAtual;
        }

        function carregarPerfil() {
            perfilAtual = document.getElementById('seletorPerfil').value;
            const chave = `telegram_${perfilAtual}`;
            const config = JSON.parse(localStorage.getItem(chave) || '{}');
            
            document.getElementById('botToken').value = config.token || '';
            document.getElementById('chatId').value = config.chatId || '';
            document.getElementById('intervalo').value = config.intervalo || 60;
            
            atualizarInfoPerfil();
            log(`üìÇ Perfil "${config.nome || perfilAtual}" carregado`, 'info');
            showNotification('info', 'Perfil Carregado', config.nome || perfilAtual, 2000);
        }

        function salvarPerfil() {
            const chave = `telegram_${perfilAtual}`;
            const token = document.getElementById('botToken').value.trim();
            const chatId = document.getElementById('chatId').value.trim();
            
            const config = JSON.parse(localStorage.getItem(chave) || '{}');
            
            const dadosPerfil = {
                nome: config.nome || perfilAtual,
                token: token,
                chatId: chatId,
                intervalo: document.getElementById('intervalo').value,
                ultimaAtualizacao: new Date().toLocaleString('pt-BR')
            };
            
            localStorage.setItem(chave, JSON.stringify(dadosPerfil));
            atualizarInfoPerfil();
            showNotification('success', 'Perfil Salvo', `${dadosPerfil.nome} salvo com sucesso!`);
            log(`üíæ Perfil "${dadosPerfil.nome}" salvo`, 'success');
        }

        function renomearPerfil() {
            const chave = `telegram_${perfilAtual}`;
            const config = JSON.parse(localStorage.getItem(chave) || '{}');
            const nomeAtual = config.nome || perfilAtual;
            
            const novoNome = prompt('üìù Digite o nome do grupo/canal:', nomeAtual);
            if (novoNome && novoNome.trim()) {
                config.nome = novoNome.trim();
                localStorage.setItem(chave, JSON.stringify(config));
                atualizarInfoPerfil();
                atualizarSeletorPerfis();
                showNotification('success', 'Perfil Renomeado', `Agora √©: ${novoNome}`);
                log(`‚úèÔ∏è Perfil renomeado para: ${novoNome}`, 'success');
            }
        }

        function atualizarInfoPerfil() {
            const chave = `telegram_${perfilAtual}`;
            const config = JSON.parse(localStorage.getItem(chave) || '{}');
            
            const nome = config.nome || 'Sem nome';
            const token = config.token ? ofuscarToken(config.token) : 'N√£o configurado';
            const chatId = config.chatId || 'N√£o configurado';
            
            document.getElementById('perfilNome').textContent = nome;
            document.getElementById('perfilToken').textContent = token;
            document.getElementById('perfilChatId').textContent = chatId;
        }

        function ofuscarToken(token) {
            if (!token || token.length < 10) return 'N√£o configurado';
            
            const partes = token.split(':');
            if (partes.length !== 2) return '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            
            const parte1 = partes[0];
            const parte2 = partes[1];
            
            return `${parte1}:${'‚Ä¢'.repeat(Math.min(parte2.length, 20))}`;
        }

        function toggleTokenVisibility() {
            const input = document.getElementById('botToken');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function log(msg, tipo = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString('pt-BR');
            let classe = '', icone = 'üìò';
            if (tipo === 'error') { classe = 'log-error'; icone = '‚ùå'; }
            else if (tipo === 'success') { classe = 'log-success'; icone = '‚úÖ'; }
            else if (tipo === 'warning') { classe = 'log-warning'; icone = '‚ö†Ô∏è'; }
            logDiv.innerHTML += `<div class="log-entry ${classe}">[${time}] ${icone} ${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function limparLog() {
            document.getElementById('log').innerHTML = '';
            log('Log limpo');
        }

        // AGENDAMENTO - FUN√á√ïES PRINCIPAIS
        function toggleAgendamento() {
            const checked = document.getElementById('agendarPost').checked;
            const fields = document.getElementById('scheduleFields');
            fields.classList.toggle('active', checked);
            
            if (checked) {
                // Preencher data e hora atual como padr√£o
                const agora = new Date();
                document.getElementById('dataAgendamento').valueAsDate = agora;
                document.getElementById('horaAgendamento').value = agora.toTimeString().slice(0, 5);
                showNotification('info', 'Agendamento Ativo', 'Configure data e hora para agendar');
            }
        }

        function atualizarCamposAgendamento() {
            const tipo = document.getElementById('tipoAgendamento').value;
            
            document.getElementById('campoDataUnica').style.display = tipo === 'unico' ? 'block' : 'none';
            document.getElementById('campoDiario').style.display = tipo === 'diario' ? 'block' : 'none';
            document.getElementById('campoSemanal').style.display = tipo === 'semanal' ? 'block' : 'none';
            document.getElementById('campoMensal').style.display = tipo === 'mensal' ? 'block' : 'none';
        }

        function calcularProximaExecucao(agendamento) {
            const agora = new Date();
            let proxima = new Date();

            switch (agendamento.tipo) {
                case 'unico':
                    proxima = new Date(agendamento.data + ' ' + agendamento.hora);
                    break;

                case 'diario':
                    const [h, m] = agendamento.hora.split(':');
                    proxima.setHours(parseInt(h), parseInt(m), 0, 0);
                    if (proxima <= agora) {
                        proxima.setDate(proxima.getDate() + 1);
                    }
                    break;

                case 'semanal':
                    const [hs, ms] = agendamento.hora.split(':');
                    proxima.setHours(parseInt(hs), parseInt(ms), 0, 0);
                    const diaAtual = proxima.getDay();
                    const diaAlvo = parseInt(agendamento.diaSemana);
                    let diff = diaAlvo - diaAtual;
                    if (diff < 0 || (diff === 0 && proxima <= agora)) {
                        diff += 7;
                    }
                    proxima.setDate(proxima.getDate() + diff);
                    break;

                case 'mensal':
                    const [hm, mm] = agendamento.hora.split(':');
                    proxima.setDate(parseInt(agendamento.diaMes));
                    proxima.setHours(parseInt(hm), parseInt(mm), 0, 0);
                    if (proxima <= agora) {
                        proxima.setMonth(proxima.getMonth() + 1);
                    }
                    break;
            }

            return proxima;
        }

        function iniciarMonitoramentoAgendados() {
            // Verifica posts agendados a cada 30 segundos
            checkAgendadosId = setInterval(verificarAgendados, 30000);
            verificarAgendados(); // Verifica imediatamente
        }

        function verificarAgendados() {
            const agora = new Date();
            
            postsAgendados.forEach((agendado, index) => {
                const proximaExecucao = calcularProximaExecucao(agendado.agendamento);
                
                // Se passou do hor√°rio (com margem de 1 minuto)
                if (proximaExecucao <= agora && agora - proximaExecucao < 60000) {
                    log(`‚è∞ Enviando post agendado: ${agendado.post.tipo}`, 'warning');
                    showNotification('warning', 'Post Agendado', 'Enviando post programado...');
                    
                    enviarPost(agendado.post);
                    
                    // Se for √∫nico, remove da lista
                    if (agendado.agendamento.tipo === 'unico') {
                        postsAgendados.splice(index, 1);
                        salvarDados();
                        atualizarFilaAgendados();
                        log('Post √∫nico enviado e removido', 'success');
                    }
                }
            });
        }

        function formatarCountdown(dataFutura) {
            const agora = new Date();
            const diff = dataFutura - agora;
            
            if (diff < 0) return 'Aguardando...';
            
            const dias = Math.floor(diff / (1000 * 60 * 60 * 24));
            const horas = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutos = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (dias > 0) return `${dias}d ${horas}h`;
            if (horas > 0) return `${horas}h ${minutos}m`;
            return `${minutos}m`;
        }

        function atualizarFilaAgendados() {
            const total = postsAgendados.length;
            document.getElementById('totalAgendados').textContent = total;
            document.getElementById('agendados').textContent = total;
            
            const container = document.getElementById('filaAgendados');
            
            if (total === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 30px 0;">Nenhum post agendado</p>';
                return;
            }

            container.innerHTML = postsAgendados.map((agendado, idx) => {
                const post = agendado.post;
                const ag = agendado.agendamento;
                const proximaExecucao = calcularProximaExecucao(ag);
                const countdown = formatarCountdown(proximaExecucao);
                
                let descricaoAgendamento = '';
                switch (ag.tipo) {
                    case 'unico':
                        descricaoAgendamento = `üìÖ ${new Date(ag.data).toLocaleDateString('pt-BR')} √†s ${ag.hora}`;
                        break;
                    case 'diario':
                        descricaoAgendamento = `üîÑ Todo dia √†s ${ag.hora}`;
                        break;
                    case 'semanal':
                        const dias = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
                        descricaoAgendamento = `üìÜ Toda ${dias[ag.diaSemana]} √†s ${ag.hora}`;
                        break;
                    case 'mensal':
                        descricaoAgendamento = `üìä Dia ${ag.diaMes} √†s ${ag.hora}`;
                        break;
                }

                return `
                    <div class="post-item scheduled-post">
                        <div class="post-header">
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span class="post-type ${post.tipo}">${post.tipo}</span>
                                <span class="countdown-badge">‚è±Ô∏è ${countdown}</span>
                            </div>
                            <button class="btn btn-small btn-danger" onclick="removerAgendado(${idx})">üóëÔ∏è</button>
                        </div>
                        <div style="color: #ffd700; font-size: 11px; margin-bottom: 6px; font-weight: 600;">
                            ${descricaoAgendamento}
                        </div>
                        <div class="post-content">
                            ${truncarTexto(post.mensagem || post.legenda || '', 60)}
                        </div>
                        <div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 6px;">
                            Pr√≥ximo envio: ${proximaExecucao.toLocaleString('pt-BR')}
                        </div>
                    </div>
                `;
            }).join('');

            // Atualizar countdown a cada minuto
            setTimeout(() => {
                if (postsAgendados.length > 0) {
                    atualizarFilaAgendados();
                }
            }, 60000);
        }

        function removerAgendado(index) {
            if (confirm('üóëÔ∏è Remover post agendado?')) {
                postsAgendados.splice(index, 1);
                salvarDados();
                atualizarFilaAgendados();
                log('Post agendado removido', 'warning');
                showNotification('info', 'Removido', 'Post agendado exclu√≠do');
            }
        }

        function limparAgendados() {
            if (confirm('‚ö†Ô∏è Limpar TODOS os posts agendados?')) {
                postsAgendados = [];
                salvarDados();
                atualizarFilaAgendados();
                log('üóëÔ∏è Posts agendados limpos', 'warning');
                showNotification('success', 'Limpo', 'Todos os agendamentos removidos');
            }
        }

        // FUN√á√ïES ORIGINAIS DO BOT
        async function testarConexao() {
            const token = document.getElementById('botToken').value.trim();
            if (!token) {
                log('Token vazio', 'error');
                showNotification('error', 'Token Vazio', 'Insira o token do bot');
                return;
            }
            try {
                log('Testando conex√£o...');
                const response = await fetch(`https://api.telegram.org/bot${token}/getMe`);
                const data = await response.json();
                if (data.ok) {
                    log(`Bot conectado: @${data.result.username}`, 'success');
                    showNotification('success', 'Conectado!', `Bot @${data.result.username} OK`);
                    salvarDados();
                } else {
                    log(`Erro: ${data.description}`, 'error');
                    showNotification('error', 'Erro', data.description);
                }
            } catch (error) {
                log(`Erro: ${error.message}`, 'error');
                showNotification('error', 'Erro', error.message);
            }
        }

        async function descobrirChatId() {
            const token = document.getElementById('botToken').value.trim();
            if (!token) {
                log('Configure o token primeiro', 'error');
                showNotification('error', 'Token Necess√°rio', 'Configure o token antes');
                return;
            }
            try {
                log('Buscando Chat ID...');
                const response = await fetch(`https://api.telegram.org/bot${token}/getUpdates`);
                const data = await response.json();
                if (data.ok && data.result.length > 0) {
                    const chatId = data.result[data.result.length - 1].message?.chat?.id;
                    if (chatId) {
                        document.getElementById('chatId').value = chatId;
                        log(`Chat ID encontrado: ${chatId}`, 'success');
                        showNotification('success', 'Encontrado', `ID: ${chatId}`);
                        salvarDados();
                    } else {
                        log('Envie mensagem no grupo primeiro', 'warning');
                        showNotification('warning', 'Sem Mensagens', 'Envie mensagem primeiro');
                    }
                } else {
                    log('Nenhuma atualiza√ß√£o encontrada', 'warning');
                    showNotification('warning', 'Nada', 'Envie mensagem no grupo');
                }
            } catch (error) {
                log(`Erro: ${error.message}`, 'error');
                showNotification('error', 'Erro', error.message);
            }
        }

        function atualizarCampos() {
            const tipo = document.getElementById('tipoPost').value;
            document.getElementById('campoTexto').style.display = tipo === 'texto' ? 'block' : 'none';
            document.getElementById('campoArquivo').style.display = tipo !== 'texto' ? 'block' : 'none';
            if (tipo === 'imagem') {
                document.getElementById('labelArquivo').textContent = 'Imagem:';
                document.getElementById('arquivo').accept = 'image/*';
            } else if (tipo === 'video') {
                document.getElementById('labelArquivo').textContent = 'V√≠deo:';
                document.getElementById('arquivo').accept = 'video/*';
            }
        }

        function previewArquivo() {
            const file = document.getElementById('arquivo').files[0];
            const preview = document.getElementById('preview');
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const tipo = document.getElementById('tipoPost').value;
                    if (tipo === 'imagem') {
                        preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; border-radius: 8px; margin: 10px 0;">`;
                    } else {
                        preview.innerHTML = `<video src="${e.target.result}" style="max-width: 100%; border-radius: 8px; margin: 10px 0;" controls></video>`;
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function adicionarPost() {
            const tipo = document.getElementById('tipoPost').value;
            const agendado = document.getElementById('agendarPost').checked;
            
            let post = { tipo, id: Date.now() };
            
            if (tipo === 'texto') {
                post.mensagem = document.getElementById('mensagemTexto').value;
                if (!post.mensagem) {
                    showNotification('error', 'Vazio', 'Digite uma mensagem');
                    return;
                }
            } else {
                const arquivo = document.getElementById('arquivo').files[0];
                if (!arquivo) {
                    showNotification('error', 'Arquivo', 'Selecione um arquivo');
                    return;
                }
                post.arquivo = arquivo;
                post.legenda = document.getElementById('legenda').value;
            }

            if (agendado) {
                const tipoAg = document.getElementById('tipoAgendamento').value;
                let agendamento = { tipo: tipoAg };

                switch (tipoAg) {
                    case 'unico':
                        agendamento.data = document.getElementById('dataAgendamento').value;
                        agendamento.hora = document.getElementById('horaAgendamento').value;
                        if (!agendamento.data || !agendamento.hora) {
                            showNotification('error', 'Incompleto', 'Preencha data e hora');
                            return;
                        }
                        break;
                    case 'diario':
                        agendamento.hora = document.getElementById('horaDiaria').value;
                        if (!agendamento.hora) {
                            showNotification('error', 'Incompleto', 'Preencha o hor√°rio');
                            return;
                        }
                        break;
                    case 'semanal':
                        agendamento.diaSemana = document.getElementById('diaSemana').value;
                        agendamento.hora = document.getElementById('horaSemanal').value;
                        if (!agendamento.hora) {
                            showNotification('error', 'Incompleto', 'Preencha o hor√°rio');
                            return;
                        }
                        break;
                    case 'mensal':
                        agendamento.diaMes = document.getElementById('diaMes').value;
                        agendamento.hora = document.getElementById('horaMensal').value;
                        if (!agendamento.diaMes || !agendamento.hora) {
                            showNotification('error', 'Incompleto', 'Preencha dia e hora');
                            return;
                        }
                        break;
                }

                postsAgendados.push({ post, agendamento });
                salvarDados();
                atualizarFilaAgendados();
                log(`Post ${tipo} agendado (${tipoAg})`, 'success');
                showNotification('success', 'Agendado!', `Post ser√° enviado automaticamente`);
            } else {
                filaDePosts.push(post);
                filaOriginal.push(post);
                atualizarFila();
                log(`Post ${tipo} adicionado`, 'success');
                showNotification('success', 'Adicionado', `Post na fila`);
            }

            limparFormulario();
        }

        function limparFormulario() {
            document.getElementById('mensagemTexto').value = '';
            document.getElementById('legenda').value = '';
            document.getElementById('arquivo').value = '';
            document.getElementById('preview').innerHTML = '';
            document.getElementById('agendarPost').checked = false;
            document.getElementById('scheduleFields').classList.remove('active');
        }

        function atualizarFila() {
            const total = filaDePosts.length;
            document.getElementById('totalPosts').textContent = total;
            const container = document.getElementById('filaPosts');
            
            if (filaOriginal.length > 0) {
                const posicao = filaOriginal.length - filaDePosts.length;
                document.getElementById('cicloAtual').textContent = `${posicao}/${filaOriginal.length}`;
            }
            
            if (filaDePosts.length === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 30px 0;">Nenhum post na fila</p>';
                return;
            }
            
            container.innerHTML = filaDePosts.map((post, idx) => `
                <div class="post-item">
                    <div class="post-header">
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span class="post-type ${post.tipo}">${post.tipo}</span>
                            <span style="color: rgba(255,255,255,0.5); font-size: 11px;">#${idx + 1}</span>
                        </div>
                        <button class="btn btn-small btn-danger" onclick="removerPost(${idx})">üóëÔ∏è</button>
                    </div>
                    <div class="post-content">
                        ${truncarTexto(post.mensagem || post.legenda || '', 80)}
                    </div>
                </div>
            `).join('');
        }

        function truncarTexto(texto, limite) {
            if (!texto) return '<span style="color: rgba(255,255,255,0.4);">Sem texto</span>';
            if (texto.length <= limite) return texto;
            return texto.substring(0, limite) + '...';
        }

        function removerPost(index) {
            filaDePosts.splice(index, 1);
            filaOriginal.splice(index, 1);
            atualizarFila();
            log('Post removido', 'success');
            showNotification('info', 'Removido', 'Post exclu√≠do');
        }

        function limparFila() {
            if (botAtivo) {
                showNotification('warning', 'Bot Ativo', 'Pare o bot antes');
                return;
            }
            if (confirm('‚ö†Ô∏è Limpar fila?')) {
                filaDePosts = [];
                filaOriginal = [];
                atualizarFila();
                log('üóëÔ∏è Fila limpa', 'warning');
                showNotification('success', 'Limpo', 'Fila zerada');
            }
        }

        async function enviarPost(post) {
            const token = document.getElementById('botToken').value.trim();
            const chatId = document.getElementById('chatId').value.trim();
            
            if (!token || !chatId) {
                log('Configure token e Chat ID', 'error');
                showNotification('error', 'Configura√ß√£o', 'Preencha token e Chat ID');
                return;
            }
            
            try {
                if (post.tipo === 'texto') {
                    log('Enviando texto...');
                    const response = await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: chatId, text: post.mensagem })
                    });
                    const data = await response.json();
                    if (data.ok) {
                        log(`Post enviado! ID: ${data.result.message_id}`, 'success');
                        showNotification('success', 'Enviado', `Post #${data.result.message_id}`);
                        postsEnviados++;
                        document.getElementById('postsEnviados').textContent = postsEnviados;
                    }
                } else {
                    const formData = new FormData();
                    formData.append('chat_id', chatId);
                    if (post.legenda) formData.append('caption', post.legenda);
                    const endpoint = post.tipo === 'imagem' ? 'sendPhoto' : 'sendVideo';
                    const field = post.tipo === 'imagem' ? 'photo' : 'video';
                    formData.append(field, post.arquivo);
                    const response = await fetch(`https://api.telegram.org/bot${token}/${endpoint}`, {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    if (data.ok) {
                        log(`Post enviado! ID: ${data.result.message_id}`, 'success');
                        showNotification('success', 'Enviado', `Post #${data.result.message_id}`);
                        postsEnviados++;
                        document.getElementById('postsEnviados').textContent = postsEnviados;
                    }
                }
            } catch (error) {
                log(`Erro: ${error.message}`, 'error');
                showNotification('error', 'Erro', error.message);
            }
        }

        async function enviarProximo() {
            if (filaDePosts.length === 0 && filaOriginal.length > 0) {
                log('üîÑ Reiniciando ciclo...', 'warning');
                filaDePosts = [...filaOriginal];
                atualizarFila();
            }
            if (filaDePosts.length === 0) {
                log('‚ùå Nenhum post configurado', 'error');
                pararBot();
                return;
            }
            const post = filaDePosts.shift();
            await enviarPost(post);
            atualizarFila();
        }

        function iniciarBot() {
            if (filaOriginal.length === 0) {
                showNotification('error', 'Fila Vazia', 'Adicione posts');
                return;
            }
            const token = document.getElementById('botToken').value.trim();
            const chatId = document.getElementById('chatId').value.trim();
            if (!token || !chatId) {
                showNotification('error', 'Configura√ß√£o', 'Preencha token e Chat ID');
                return;
            }
            
            botAtivo = true;
            document.getElementById('status').className = 'status online';
            document.getElementById('status').innerHTML = '<span class="status-dot"></span> Online';
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            inicioBot = Date.now();
            
            const intervalo = parseInt(document.getElementById('intervalo').value) * 60000;
            log('‚ñ∂Ô∏è Bot iniciado', 'success');
            showNotification('success', 'Iniciado', 'Bot em execu√ß√£o');
            
            setTimeout(() => { if (botAtivo) enviarProximo(); }, 5000);
            intervaloId = setInterval(enviarProximo, intervalo);
            tempoRodandoId = setInterval(atualizarTempo, 1000);
        }

        function pararBot() {
            botAtivo = false;
            clearInterval(intervaloId);
            clearInterval(tempoRodandoId);
            document.getElementById('status').className = 'status offline';
            document.getElementById('status').innerHTML = '<span class="status-dot"></span> Offline';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            log('Bot parado', 'warning');
            showNotification('warning', 'Parado', 'Bot desativado');
        }

        function atualizarTempo() {
            if (!inicioBot) return;
            const diff = Date.now() - inicioBot;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('tempoRodando').textContent = 
                `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        // ===================================
        // SISTEMA DE TEMPLATES
        // ===================================
        function salvarTemplate() {
            const tipo = document.getElementById('tipoPost').value;
            let conteudo = {};
            
            if (tipo === 'texto') {
                conteudo.mensagem = document.getElementById('mensagemTexto').value;
                if (!conteudo.mensagem) {
                    showNotification('error', 'Vazio', 'Digite uma mensagem para salvar');
                    return;
                }
            } else {
                conteudo.legenda = document.getElementById('legenda').value;
                if (!conteudo.legenda) {
                    showNotification('error', 'Vazio', 'Digite uma legenda para salvar');
                    return;
                }
            }
            
            const nome = prompt('üìù Nome do template:', `Template ${tipo} ${templates.length + 1}`);
            if (!nome) return;
            
            const template = {
                id: Date.now(),
                nome: nome.trim(),
                tipo: tipo,
                conteudo: conteudo,
                dataCriacao: new Date().toLocaleString('pt-BR')
            };
            
            templates.push(template);
            salvarDados();
            atualizarListaTemplates();
            
            log(`üé® Template "${nome}" salvo`, 'success');
            showNotification('success', 'Template Salvo', `"${nome}" adicionado √† biblioteca`);
        }

        function atualizarListaTemplates() {
            const total = templates.length;
            document.getElementById('totalTemplates').textContent = total;
            
            const container = document.getElementById('listaTemplates');
            
            if (total === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 30px 0;">Nenhum template salvo</p>';
                return;
            }
            
            container.innerHTML = templates.map((template, idx) => `
                <div class="post-item" style="background: rgba(185, 255, 0, 0.05);">
                    <div class="post-header">
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span class="post-type ${template.tipo}">${template.tipo}</span>
                            <span style="color: #b9ff00; font-size: 12px; font-weight: 600;">üìù ${template.nome}</span>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="btn btn-small btn-success" onclick="carregarTemplate(${idx})" title="Carregar">üìã</button>
                            <button class="btn btn-small btn-danger" onclick="removerTemplate(${idx})" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="post-content">
                        ${truncarTexto(template.conteudo.mensagem || template.conteudo.legenda || '', 80)}
                    </div>
                    <div style="font-size: 10px; color: rgba(255,255,255,0.4); margin-top: 6px;">
                        Criado em: ${template.dataCriacao}
                    </div>
                </div>
            `).join('');
        }

        function carregarTemplate(index) {
            const template = templates[index];
            
            // Ajustar tipo de post
            document.getElementById('tipoPost').value = template.tipo;
            atualizarCampos();
            
            // Carregar conte√∫do
            if (template.tipo === 'texto') {
                document.getElementById('mensagemTexto').value = template.conteudo.mensagem;
            } else {
                document.getElementById('legenda').value = template.conteudo.legenda;
            }
            
            log(`üìã Template "${template.nome}" carregado`, 'success');
            showNotification('success', 'Template Carregado', `"${template.nome}" pronto para edi√ß√£o`);
            
            // Scroll para o formul√°rio
            document.querySelector('.center-column').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function removerTemplate(index) {
            const template = templates[index];
            if (confirm(`üóëÔ∏è Excluir template "${template.nome}"?`)) {
                templates.splice(index, 1);
                salvarDados();
                atualizarListaTemplates();
                log(`Template "${template.nome}" removido`, 'warning');
                showNotification('info', 'Removido', 'Template exclu√≠do');
            }
        }

        // ===================================
        // SISTEMA DE BACKUP/RESTORE
        // ===================================
        function exportarConfiguracao() {
            const dados = {
                versao: '2.0',
                dataExportacao: new Date().toLocaleString('pt-BR'),
                configuracoes: {
                    token: document.getElementById('botToken').value,
                    chatId: document.getElementById('chatId').value,
                    intervalo: document.getElementById('intervalo').value
                },
                postsAgendados: postsAgendados,
                templates: templates,
                estatisticas: {
                    postsEnviados: postsEnviados,
                    totalTemplates: templates.length,
                    totalAgendados: postsAgendados.length
                }
            };
            
            const json = JSON.stringify(dados, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `telegram-bot-backup-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('üì• Backup exportado com sucesso', 'success');
            showNotification('success', 'Backup Criado', 'Arquivo baixado com sucesso!');
        }

        function importarConfiguracao(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    // Validar estrutura b√°sica
                    if (!dados.versao || !dados.configuracoes) {
                        throw new Error('Arquivo de backup inv√°lido');
                    }
                    
                    // Confirmar importa√ß√£o
                    const msg = `üì§ Importar backup de ${dados.dataExportacao}?\n\n` +
                                `‚Ä¢ ${dados.templates?.length || 0} templates\n` +
                                `‚Ä¢ ${dados.postsAgendados?.length || 0} posts agendados\n\n` +
                                `‚ö†Ô∏è Dados atuais ser√£o substitu√≠dos!`;
                    
                    if (!confirm(msg)) {
                        log('Importa√ß√£o cancelada', 'warning');
                        return;
                    }
                    
                    // Restaurar configura√ß√µes
                    if (dados.configuracoes.token) {
                        document.getElementById('botToken').value = dados.configuracoes.token;
                    }
                    if (dados.configuracoes.chatId) {
                        document.getElementById('chatId').value = dados.configuracoes.chatId;
                    }
                    if (dados.configuracoes.intervalo) {
                        document.getElementById('intervalo').value = dados.configuracoes.intervalo;
                    }
                    
                    // Restaurar dados
                    templates = dados.templates || [];
                    postsAgendados = dados.postsAgendados || [];
                    
                    // Salvar e atualizar
                    salvarDados();
                    atualizarListaTemplates();
                    atualizarFilaAgendados();
                    
                    log(`‚úÖ Backup importado: ${dados.templates?.length || 0} templates, ${dados.postsAgendados?.length || 0} agendados`, 'success');
                    showNotification('success', 'Backup Restaurado', 'Configura√ß√µes importadas com sucesso!');
                    
                } catch (error) {
                    log(`Erro ao importar: ${error.message}`, 'error');
                    showNotification('error', 'Erro na Importa√ß√£o', error.message);
                }
            };
            reader.readAsText(file);
            
            // Limpar input
            event.target.value = '';
        }
    </script>
</body>
</html>
